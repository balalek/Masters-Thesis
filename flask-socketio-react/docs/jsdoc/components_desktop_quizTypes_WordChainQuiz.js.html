<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>components/desktop/quizTypes/WordChainQuiz.js - Home Quiz Documentation</title>
    
    <meta name="description" content="Documentation for the Home Quiz application" />
    
        <meta name="keywords" content="react, quiz, documentation" />
        <meta name="keyword" content="react, quiz, documentation" />
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-App.html">App</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-App.html#~App">App</a></li></ul></li><li><a href="module-Components_Desktop_Miscellaneous_GameCountdown.html">Components/Desktop/Miscellaneous/GameCountdown</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Components_Desktop_Miscellaneous_GameCountdown.html#~GameCountdown">GameCountdown</a></li></ul></li><li><a href="module-Components_Desktop_Miscellaneous_ImageBlockReveal.html">Components/Desktop/Miscellaneous/ImageBlockReveal</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Components_Desktop_Miscellaneous_ImageBlockReveal.html#~ImageBlockReveal">ImageBlockReveal</a></li><li data-type='method' style='display: none;'><a href="module-Components_Desktop_Miscellaneous_ImageBlockReveal.html#~getContainerStyle">getContainerStyle</a></li><li data-type='method' style='display: none;'><a href="module-Components_Desktop_Miscellaneous_ImageBlockReveal.html#~handleImageLoad">handleImageLoad</a></li></ul></li><li><a href="module-Components_Desktop_Miscellaneous_Leaderboard.html">Components/Desktop/Miscellaneous/Leaderboard</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Components_Desktop_Miscellaneous_Leaderboard.html#~Leaderboard">Leaderboard</a></li><li data-type='method' style='display: none;'><a href="module-Components_Desktop_Miscellaneous_Leaderboard.html#~renderPlayer">renderPlayer</a></li></ul></li><li><a href="module-Components_Desktop_Miscellaneous_QuestionPreview.html">Components/Desktop/Miscellaneous/QuestionPreview</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Components_Desktop_Miscellaneous_QuestionPreview.html#~QuestionPreview">QuestionPreview</a></li></ul></li><li><a href="module-Components_Desktop_Miscellaneous_QuickPlayModal.html">Components/Desktop/Miscellaneous/QuickPlayModal</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Components_Desktop_Miscellaneous_QuickPlayModal.html#~QuickPlayModal">QuickPlayModal</a></li><li data-type='method' style='display: none;'><a href="module-Components_Desktop_Miscellaneous_QuickPlayModal.html#~handleStartGame">handleStartGame</a></li></ul></li><li><a href="module-Components_Desktop_Room_ConnectionInfo.html">Components/Desktop/Room/ConnectionInfo</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Components_Desktop_Room_ConnectionInfo.html#~ConnectionInfo">ConnectionInfo</a></li></ul></li><li><a href="module-Components_Desktop_Room_PlayersList.html">Components/Desktop/Room/PlayersList</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Components_Desktop_Room_PlayersList.html#~PlayersList">PlayersList</a></li><li data-type='method' style='display: none;'><a href="module-Components_Desktop_Room_PlayersList.html#~distributePlayersInColumns">distributePlayersInColumns</a></li></ul></li><li><a href="module-Components_Desktop_Room_StartGameTooltip.html">Components/Desktop/Room/StartGameTooltip</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Components_Desktop_Room_StartGameTooltip.html#~StartGameTooltip">StartGameTooltip</a></li></ul></li><li><a href="module-Components_Desktop_Room_TeamMode.html">Components/Desktop/Room/TeamMode</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Components_Desktop_Room_TeamMode.html#~TeamContainer">TeamContainer</a></li><li data-type='method' style='display: none;'><a href="module-Components_Desktop_Room_TeamMode.html#~TeamMode">TeamMode</a></li></ul></li><li><a href="module-Constants_QuizValidation.html">Constants/QuizValidation</a></li><li><a href="module-Pages_Desktop_Game_GamePage.html">Pages/Desktop/Game/GamePage</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_Game_GamePage.html#~GamePage">GamePage</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_Game_GamePage.html#~renderQuizType">renderQuizType</a></li></ul></li><li><a href="module-Pages_Desktop_Game_RemoteGamePage.html">Pages/Desktop/Game/RemoteGamePage</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_Game_RemoteGamePage.html#~RemoteGamePage">RemoteGamePage</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_Game_RemoteGamePage.html#~handleCountdownComplete">handleCountdownComplete</a></li></ul></li><li><a href="module-Pages_Desktop_HomePage_DesktopHomePage.html">Pages/Desktop/HomePage/DesktopHomePage</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_HomePage_DesktopHomePage.html#~DesktopHomePage">DesktopHomePage</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_HomePage_DesktopHomePage.html#~QuizTypeButton">QuizTypeButton</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_HomePage_DesktopHomePage.html#~continueUnfinishedQuiz">continueUnfinishedQuiz</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_HomePage_DesktopHomePage.html#~deleteUnfinishedQuiz">deleteUnfinishedQuiz</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_HomePage_DesktopHomePage.html#~fetchQuizzes">fetchQuizzes</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_HomePage_DesktopHomePage.html#~fetchUnfinishedQuizzes">fetchUnfinishedQuizzes</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_HomePage_DesktopHomePage.html#~handleCloseSnackbar">handleCloseSnackbar</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_HomePage_DesktopHomePage.html#~handleCreateCopy">handleCreateCopy</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_HomePage_DesktopHomePage.html#~handleDeleteQuiz">handleDeleteQuiz</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_HomePage_DesktopHomePage.html#~handleEditPublicQuiz">handleEditPublicQuiz</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_HomePage_DesktopHomePage.html#~handleEditQuiz">handleEditQuiz</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_HomePage_DesktopHomePage.html#~handleQuickPlayClick">handleQuickPlayClick</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_HomePage_DesktopHomePage.html#~handleStartQuickPlay">handleStartQuickPlay</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_HomePage_DesktopHomePage.html#~handleToggleShare">handleToggleShare</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_HomePage_DesktopHomePage.html#~loadMore">loadMore</a></li></ul></li><li><a href="module-Pages_Desktop_HomePage_QuizListItem.html">Pages/Desktop/HomePage/QuizListItem</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_HomePage_QuizListItem.html#~QuizListItem">QuizListItem</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_HomePage_QuizListItem.html#~handleEdit">handleEdit</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_HomePage_QuizListItem.html#~handleStartQuiz">handleStartQuiz</a></li></ul></li><li><a href="module-Pages_Desktop_Room_RoomPage.html">Pages/Desktop/Room/RoomPage</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_Room_RoomPage.html#~RoomPage">RoomPage</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_Room_RoomPage.html#~getConnectionUrl">getConnectionUrl</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_Room_RoomPage.html#~getRemoteGameUrl">getRemoteGameUrl</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_Room_RoomPage.html#~handleChangeBlueTeamCaptain">handleChangeBlueTeamCaptain</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_Room_RoomPage.html#~handleChangeRedTeamCaptain">handleChangeRedTeamCaptain</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_Room_RoomPage.html#~handleCloseQuiz">handleCloseQuiz</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_Room_RoomPage.html#~handleCountdownComplete">handleCountdownComplete</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_Room_RoomPage.html#~handleModeChange">handleModeChange</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_Room_RoomPage.html#~handleSelectCaptain">handleSelectCaptain</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_Room_RoomPage.html#~handleStartGame">handleStartGame</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_Room_RoomPage.html#~handleStartGameOnAnotherScreen">handleStartGameOnAnotherScreen</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_Room_RoomPage.html#~handleSwitchTeam">handleSwitchTeam</a></li></ul></li><li><a href="module-Pages_Desktop_ScorePage_FinalScorePage.html">Pages/Desktop/ScorePage/FinalScorePage</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_ScorePage_FinalScorePage.html#~FinalScorePage">FinalScorePage</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_ScorePage_FinalScorePage.html#~handleCloseQuiz">handleCloseQuiz</a></li></ul></li><li><a href="module-Pages_Desktop_ScorePage_ScorePage.html">Pages/Desktop/ScorePage/ScorePage</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_ScorePage_ScorePage.html#~ScorePage">ScorePage</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_ScorePage_ScorePage.html#~handleCloseQuiz">handleCloseQuiz</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Desktop_ScorePage_ScorePage.html#~renderAnswers">renderAnswers</a></li></ul></li><li><a href="module-Pages_Mobile_Game_MobileGamePage.html">Pages/Mobile/Game/MobileGamePage</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Pages_Mobile_Game_MobileGamePage.html#~MobileGamePage">MobileGamePage</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Mobile_Game_MobileGamePage.html#~handleAnswer">handleAnswer</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Mobile_Game_MobileGamePage.html#~handleBlindMapAnswer">handleBlindMapAnswer</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Mobile_Game_MobileGamePage.html#~handleCaptainChoice">handleCaptainChoice</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Mobile_Game_MobileGamePage.html#~handleDrawingSubmit">handleDrawingSubmit</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Mobile_Game_MobileGamePage.html#~handleMathAnswer">handleMathAnswer</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Mobile_Game_MobileGamePage.html#~handleMoreLessVote">handleMoreLessVote</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Mobile_Game_MobileGamePage.html#~handleNumberGuess">handleNumberGuess</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Mobile_Game_MobileGamePage.html#~handleOpenAnswer">handleOpenAnswer</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Mobile_Game_MobileGamePage.html#~handleWordChainSubmit">handleWordChainSubmit</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Mobile_Game_MobileGamePage.html#~handleWordSelected">handleWordSelected</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Mobile_Game_MobileGamePage.html#~renderQuizType">renderQuizType</a></li></ul></li><li><a href="module-Pages_Mobile_JoinQuizRoom_MobileJoinQuizRoom.html">Pages/Mobile/JoinQuizRoom/MobileJoinQuizRoom</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Pages_Mobile_JoinQuizRoom_MobileJoinQuizRoom.html#~MobileJoinQuizRoom">MobileJoinQuizRoom</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Mobile_JoinQuizRoom_MobileJoinQuizRoom.html#~handleJoinGame">handleJoinGame</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Mobile_JoinQuizRoom_MobileJoinQuizRoom.html#~handleNameChange">handleNameChange</a></li><li data-type='method' style='display: none;'><a href="module-Pages_Mobile_JoinQuizRoom_MobileJoinQuizRoom.html#~handleReset">handleReset</a></li></ul></li><li><a href="module-Themes.html">Themes</a></li><li><a href="module-Utils_LetterReveal.html">Utils/LetterReveal</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Utils_LetterReveal.html#~createInitialMask">createInitialMask</a></li><li data-type='method' style='display: none;'><a href="module-Utils_LetterReveal.html#~shouldRevealLetter">shouldRevealLetter</a></li></ul></li><li><a href="module-Utils_MathRenderer.html">Utils/MathRenderer</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Utils_MathRenderer.html#~renderMathEquation">renderMathEquation</a></li></ul></li><li><a href="module-Utils_ScrollbarStyle.html">Utils/ScrollbarStyle</a></li><li><a href="module-Utils_Socket.html">Utils/Socket</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Utils_Socket.html#~getServerTime">getServerTime</a></li><li data-type='method' style='display: none;'><a href="module-Utils_Socket.html#~getSocket">getSocket</a></li><li data-type='method' style='display: none;'><a href="module-Utils_Socket.html#~synchronizeTime">synchronizeTime</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#MathQuiz">MathQuiz</a></li><li><a href="global.html#WordChainQuiz">WordChainQuiz</a></li><li><a href="global.html#fixAnagram">fixAnagram</a></li><li><a href="global.html#generateAnagram">generateAnagram</a></li><li><a href="global.html#isValidAnagram">isValidAnagram</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">components/desktop/quizTypes/WordChainQuiz.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState, useEffect, useRef } from 'react';
import { 
  Box, 
  Typography, 
  Paper, 
  Avatar, 
  LinearProgress,
  Divider,
  Chip
} from '@mui/material';
import { getSocket, getServerTime } from '../../../utils/socket';

/**
 * Component to display a Word Chain quiz game
 */
const WordChainQuiz = ({ question, question_end_time }) => {
  const [wordChain, setWordChain] = useState([]);
  const [currentLetter, setCurrentLetter] = useState(question?.first_letter || '');
  const [currentPlayer, setCurrentPlayer] = useState(question?.current_player || '');
  const [eliminatedPlayers, setEliminatedPlayers] = useState([]);
  const [playerTimers, setPlayerTimers] = useState(() => {
    // Initialize playerTimers from question if available - all players get the same timer
    if (question?.players) {
      const initialTimers = {};
      const timerValue = question.length * 1000; // Same timer value for everyone
      Object.keys(question.players).forEach(playerName => {
        initialTimers[playerName] = timerValue;
      });
      return initialTimers;
    }
    return {};
  });
  
  const [scores, setScores] = useState(() => {
    // Initialize scores from the players data in the question
    if (question?.players) {
      const initialScores = { individual: {} };
      Object.entries(question.players).forEach(([playerName, playerData]) => {
        initialScores.individual[playerName] = {
          score: playerData.score || 0,
          color: playerData.color
        };
      });
      return initialScores;
    }
    return {};
  });
  const [isTeamMode, setIsTeamMode] = useState(question?.is_team_mode || false);
  const [bombTicking, setBombTicking] = useState(false);
  const [sparklesShowing, setSparklesShowing] = useState(false);  // New state for sparkles at 40%
  const [timeRemaining, setTimeRemaining] = useState(question?.length || 0);

  // New state for tracking timer status
  const [activeTimer, setActiveTimer] = useState(question?.current_player || null);
  const [isPaused, setIsPaused] = useState(false);
  const timerIntervalRef = useRef(null);
  const lastTickTimeRef = useRef(getServerTime());

  // Add ref for auto-scrolling
  const wordChainContainerRef = useRef(null);
  
  const [gameSpecificPoints, setGameSpecificPoints] = useState({});

  const [previousPlayers, setPreviousPlayers] = useState([]);
  const [nextPlayers, setNextPlayers] = useState(question?.next_players || []);

  // Initialize with first word and next players
  useEffect(() => {
    if (question?.first_word &amp;&amp; wordChain.length === 0) {
      setWordChain([{
        word: question.first_word,
        player: 'system',
        team: null
      }]);
      setCurrentLetter(question.first_letter || '');
      // Set system as the previous player when game starts
      setPreviousPlayers(['system']);
      setNextPlayers(question?.next_players || []); // Initialize next players from question
      console.log("Initialized word chain with:", question.first_word, "and letter:", question.first_letter);
    }
  }, [question, wordChain.length]);

  // Auto-scroll to bottom when wordChain updates
  useEffect(() => {
    if (wordChainContainerRef.current &amp;&amp; wordChain.length > 0) {
      const container = wordChainContainerRef.current;
      container.scrollTop = container.scrollHeight;
    }
  }, [wordChain]);

  // Main socket effect with proper timer management
  useEffect(() => {
    const socket = getSocket();

    // Handle timer for initial player
    if (currentPlayer &amp;&amp; !timerIntervalRef.current) {
      lastTickTimeRef.current = getServerTime();
      startTimeForPlayer(currentPlayer);
    }

    socket.on('word_chain_update', (data) => {
      console.log('word_chain_update received:', {
        newCurrentPlayer: data.current_player,
        currentPlayer,
        timerExists: !!timerIntervalRef.current
      });
      
      // Update state
      setWordChain(data.word_chain || []);
      setCurrentLetter(data.current_letter || '');
      setEliminatedPlayers(data.eliminated_players || []);
      setScores(data.scores || {});
      
      // Track game-specific points if available
      if (data.game_points) {
        setGameSpecificPoints(data.game_points);
      }
      
      const newCurrentPlayer = data.current_player || '';
      
      // Handle player change and timer management
      if (newCurrentPlayer !== currentPlayer) {
        // Stop current timer
        if (timerIntervalRef.current) {
          clearInterval(timerIntervalRef.current);
          timerIntervalRef.current = null;
        }
        
        // Update states
        setCurrentPlayer(newCurrentPlayer);
        setActiveTimer(newCurrentPlayer);
        lastTickTimeRef.current = getServerTime();
        
        // Start timer for new player
        startTimeForPlayer(newCurrentPlayer);
      }

      setPreviousPlayers(data.previous_players || []);
      setNextPlayers(data.next_players || []);
    });

    // Instead of setting up a bomb timer, we'll update the timeRemaining state regularly
    // and show the bomb ticking animation when remaining time is low
    if (isTeamMode &amp;&amp; question_end_time) {
      const timerInterval = setInterval(() => {
        const now = getServerTime();
        const remaining = Math.max(0, question_end_time - now);
        setTimeRemaining(remaining);
        
        // Calculate time percentage
        const totalTime = question?.length * 1000 || 0;
        const timePercentage = remaining / totalTime * 100;
        
        // Start showing sparkles at 40%
        if (timePercentage &lt; 40) {
          setSparklesShowing(true);
        } else {
          setSparklesShowing(false);
        }
        
        // If less than 10% of time remains, show the bomb ticking animation
        if (timePercentage &lt; 10) {
          setBombTicking(true);
        } else {
          setBombTicking(false);
        }
      }, 100);
      
      return () => {
        clearInterval(timerInterval);
        if (timerIntervalRef.current) {
          clearInterval(timerIntervalRef.current);
          timerIntervalRef.current = null;
        }
      };
    }

    function startTimeForPlayer(player) {
      if (!timerIntervalRef.current &amp;&amp; !isPaused) {
        timerIntervalRef.current = setInterval(() => {
          const now = getServerTime();
          const elapsed = now - lastTickTimeRef.current;
          lastTickTimeRef.current = now;
          
          setPlayerTimers(prevTimers => {
            const newTimers = { ...prevTimers };
            if (newTimers[player]) {
              newTimers[player] = Math.max(0, newTimers[player] - elapsed);
              //console.log(`Timer update - Player: ${player}, Time: ${Math.floor(newTimers[player] / 1000)}s`);
              
              if (newTimers[player] === 0) {
                clearInterval(timerIntervalRef.current);
                timerIntervalRef.current = null;
                socket.emit('word_chain_timeout', { player });
              }
            }
            return newTimers;
          });
        }, 100);
      }
    }

    return () => {
      socket.off('word_chain_update');
      if (timerIntervalRef.current) {
        clearInterval(timerIntervalRef.current);
        timerIntervalRef.current = null;
      }
    };
  }, [currentPlayer, isPaused, question_end_time, isTeamMode, question]);

  // Determine if the current player is from the blue team
  const isCurrentPlayerBlue = isTeamMode &amp;&amp; 
    scores?.blue_team?.includes(currentPlayer);

  // Function to render player timers
  const renderPlayerTimers = () => {
    if (isTeamMode) {
      // Helper function to render sparkles - reused for both warning states
      const renderSparkles = () => (
        [...Array(12)].map((_, i) => (
          &lt;Box
            key={`sparkle-${i}`}
            sx={{
              position: 'absolute',
              width: `${4 + Math.random() * 6}px`,
              height: `${4 + Math.random() * 6}px`,
              backgroundColor: i % 3 === 0 ? '#FCD34D' : '#F87171',
              borderRadius: '50%',
              opacity: 0.8,
              top: `${Math.random() * 100}%`,
              left: `${Math.random() * 100}%`,
              animation: `sparkleFloat${i % 4} ${1 + Math.random() * 2}s infinite linear`,
              '@keyframes sparkleFloat0': {
                '0%': { transform: 'translate(0, 0)' },
                '100%': { transform: `translate(${80 + Math.random() * 50}px, ${-40 - Math.random() * 60}px)`, opacity: 0 }
              },
              '@keyframes sparkleFloat1': {
                '0%': { transform: 'translate(0, 0)' },
                '100%': { transform: `translate(${-80 - Math.random() * 50}px, ${-40 - Math.random() * 60}px)`, opacity: 0 }
              },
              '@keyframes sparkleFloat2': {
                '0%': { transform: 'translate(0, 0)' },
                '100%': { transform: `translate(${80 + Math.random() * 50}px, ${40 + Math.random() * 60}px)`, opacity: 0 }
              },
              '@keyframes sparkleFloat3': {
                '0%': { transform: 'translate(0, 0)' },
                '100%': { transform: `translate(${-80 - Math.random() * 50}px, ${40 + Math.random() * 60}px)`, opacity: 0 }
              }
            }}
          />
        ))
      );

      return (
        &lt;Box sx={{ position: 'relative' }}>
          {/* Early warning (40-10%) - just sparkles */}
          {sparklesShowing &amp;&amp; !bombTicking &amp;&amp; (
            &lt;Box
              sx={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                pointerEvents: 'none',
                zIndex: 1000
              }}
            >
              {renderSparkles()}
            &lt;/Box>
          )}

          {/* Critical warning (&lt;10%) - sparkles + flashing background */}
          {bombTicking &amp;&amp; (
            &lt;Box
              sx={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                pointerEvents: 'none',
                zIndex: 1000,
                animation: 'flashWarning 0.7s infinite',
                '@keyframes flashWarning': {
                  '0%, 100%': { backgroundColor: 'transparent' },
                  '50%': { backgroundColor: 'rgba(239, 68, 68, 0.25)' }
                }
              }}
            >
              {renderSparkles()}
            &lt;/Box>
          )}
        &lt;/Box>
      );
    } else {
      // For free-for-all mode, show individual player timers
      // Get players from playerTimers, or fallback to scores, or question.players
      let activePlayerNames = [];
      
      if (Object.keys(playerTimers).length > 0) {
        activePlayerNames = Object.keys(playerTimers);
      } else if (scores?.individual &amp;&amp; Object.keys(scores.individual).length > 0) {
        activePlayerNames = Object.keys(scores.individual);
      } else if (question?.players) {
        activePlayerNames = Object.keys(question.players);
      }
      
      // Filter out eliminated players
      activePlayerNames = activePlayerNames.filter(name => !eliminatedPlayers.includes(name));
      
      // Sort by player_order if available
      if (question?.player_order &amp;&amp; question.player_order.length > 0) {
        const orderMap = {};
        question.player_order.forEach((name, idx) => {
          orderMap[name] = idx;
        });
        
        activePlayerNames.sort((a, b) => {
          const orderA = orderMap[a] !== undefined ? orderMap[a] : 999;
          const orderB = orderMap[b] !== undefined ? orderMap[b] : 999;
          return orderA - orderB;
        });
      }
      
      return (
        &lt;Box 
          sx={{ 
            mt: 4,
            display: 'flex',
            justifyContent: 'center',
            alignItems: 'center',
          }}
        >
          &lt;Box 
            sx={{ 
              display: 'grid',
              gridTemplateColumns: {
                xs: `repeat(${Math.min(4, activePlayerNames.length)}, 1fr)`,
                sm: `repeat(${Math.min(6, activePlayerNames.length)}, 1fr)`,
                md: `repeat(${Math.min(8, activePlayerNames.length)}, 1fr)`,
                lg: `repeat(${Math.min(10, activePlayerNames.length)}, 1fr)`
              },
              gap: 2,
              maxWidth: {
                xs: activePlayerNames.length > 4 ? '100%' : `${activePlayerNames.length * 160 + (activePlayerNames.length-1) * 16}px`,
                sm: activePlayerNames.length > 6 ? '100%' : `${activePlayerNames.length * 160 + (activePlayerNames.length-1) * 16}px`,
                md: activePlayerNames.length > 8 ? '100%' : `${activePlayerNames.length * 160 + (activePlayerNames.length-1) * 16}px`,
                lg: activePlayerNames.length > 10 ? '100%' : `${activePlayerNames.length * 160 + (activePlayerNames.length-1) * 16}px`
              }
            }}
          >
            {activePlayerNames.map((playerName) => {
              const isCurrentTurn = playerName === currentPlayer;
              
              // Check if data structure is as expected, otherwise try alternate paths
              const playerColor = scores?.individual?.[playerName]?.color || '#ccc';
              
              const playerScore = scores?.individual?.[playerName]?.score || 0;
              const timeRemaining = playerTimers[playerName] || 0;
              const totalTime = question?.length * 1000 || 30000;
              const timePercentage = (timeRemaining / totalTime) * 100;
              
              // Add a pulsing effect when it's a player's turn
              const isPulsing = isCurrentTurn &amp;&amp; !isPaused;
              
              return (
                &lt;Box key={playerName}>
                  &lt;Paper 
                    elevation={isCurrentTurn ? 6 : 1}
                    sx={{ 
                      p: 1.5, 
                      position: 'relative',
                      height: '165px', 
                      width: '160px',   
                      borderRadius: 2,
                      display: 'flex',
                      flexDirection: 'column',
                      alignItems: 'center',
                      transform: isCurrentTurn ? 'scale(1.1)' : 'scale(1)',
                      transition: 'transform 0.3s ease',
                      borderTop: isCurrentTurn ? `5px solid ${playerColor}` : 'none',
                      animation: isPulsing ? 'pulseLight 2s infinite' : 'none',
                      bgcolor: eliminatedPlayers.includes(playerName) ? 'rgba(244, 67, 54, 0.1)' : 'background.paper',
                      opacity: eliminatedPlayers.includes(playerName) ? 0.7 : 1,
                      '@keyframes pulseLight': {
                        '0%': { boxShadow: '0 0 0 0 rgba(0, 0, 0, 0.1)' },
                        '70%': { boxShadow: '0 0 0 10px rgba(0, 0, 0, 0)' },
                        '100%': { boxShadow: '0 0 0 0 rgba(0, 0, 0, 0)' }
                      }
                    }}
                  >
                    {eliminatedPlayers.includes(playerName) &amp;&amp; (
                      &lt;Box sx={{ 
                        position: 'absolute', 
                        top: 0, 
                        left: 0, 
                        right: 0, 
                        bottom: 0, 
                        display: 'flex', 
                        alignItems: 'center', 
                        justifyContent: 'center',
                        zIndex: 1,
                        transform: 'rotate(-15deg)'
                      }}>
                        &lt;Typography variant="h5" color="error" fontWeight="bold">
                          VYŘAZEN
                        &lt;/Typography>
                      &lt;/Box>
                    )}
                    
                    {/* Avatar at the top with player's color */}
                    &lt;Avatar 
                      sx={{ 
                        bgcolor: playerColor,
                        width: 48,
                        height: 48,
                        fontSize: '1.5rem',
                        mb: 2,
                        color: 'white',
                        opacity: eliminatedPlayers.includes(playerName) ? 0.5 : 1
                      }}
                    >
                      {playerName.charAt(0).toUpperCase()}
                    &lt;/Avatar>
                    
                    {/* Timer bar */}
                    &lt;LinearProgress 
                      variant="determinate" 
                      value={eliminatedPlayers.includes(playerName) ? 0 : timePercentage} 
                      color={timePercentage > 60 ? "success" : timePercentage > 30 ? "warning" : "error"}
                      sx={{ 
                        height: 8, 
                        width: '100%',
                        borderRadius: 4,
                        mb: 0
                      }}
                    />
                    
                    {/* Time remaining */}
                    &lt;Typography sx={{ 
                      fontSize: '1.5rem', 
                      fontWeight: 'bold',
                      color: timePercentage &lt;= 30 ? 'error.main' : 'inherit',
                      opacity: eliminatedPlayers.includes(playerName) ? 0.5 : 1
                    }}>
                      {eliminatedPlayers.includes(playerName) ? '0s' : `${Math.floor(timeRemaining / 1000)}s`}
                    &lt;/Typography>
                    
                    &lt;Divider sx={{ width: '100%', my: 1 }} />
                    
                    {/* Score */}
                    &lt;Typography fontWeight="bold" sx={{ 
                      fontSize: '1.2rem',
                      opacity: eliminatedPlayers.includes(playerName) ? 0.5 : 1
                    }}>
                      {gameSpecificPoints[playerName] ? Math.round(gameSpecificPoints[playerName]) : 0} bodů
                    &lt;/Typography>
                  &lt;/Paper>
                &lt;/Box>
              );
            })}
          &lt;/Box>
        &lt;/Box>
      );
    }
  };

  // Render the actual word chain
  const renderWordChain = () => {
    if (!wordChain.length) {
      return (
        &lt;Box sx={{ textAlign: 'center', mt: 4 }}>
          &lt;Typography variant="h4" color="text.secondary">
            Čekáme na první slovo...
          &lt;/Typography>
        &lt;/Box>
      );
    }
    
    return (
      &lt;Box 
        ref={wordChainContainerRef}
        sx={{ 
          display: 'flex',
          flexWrap: 'wrap',
          alignItems: 'center',
          justifyContent: 'center',
          gap: 2,
          mt: 0, 
          maxWidth: '100%',
          overflowX: 'auto',
          overflowY: 'auto',
          maxHeight: '100%',
          p: 3
        }}
      >
        {wordChain.map((item, index) => {
          const { word, player, team } = item;
          const playerColor = team 
            ? (team === 'blue' ? '#186CF6' : '#EF4444')
            : (scores?.individual?.[player]?.color || '#ccc');
          
          // For the first word (system word) or last word, use different styles
          const isSystemWord = player === 'system';
          const isLastWord = index === wordChain.length - 1;
          
          return (
            &lt;React.Fragment key={`${word}-${index}`}>
              {/* Arrow between words */}
              {index > 0 &amp;&amp; (
                &lt;Typography variant="h4" sx={{ mx: 1.5, color: 'text.secondary' }}>
                  →
                &lt;/Typography>
              )}
              
              {/* Word chip */}
              &lt;Chip
                label={
                  &lt;Typography 
                    variant="h6" 
                    sx={{ 
                      fontWeight: 'bold',
                      color: 'white'
                    }}
                  >
                    {word}
                  &lt;/Typography>
                }
                sx={{ 
                  bgcolor: isLastWord 
                    ? 'success.main' 
                    : ('grey.700'),
                  height: 52,
                  borderRadius: 3,
                  px: 2,
                  transform: isLastWord ? 'scale(1.2)' : 'scale(1)',
                  boxShadow: isLastWord ? 5 : 2
                }}
              />
            &lt;/React.Fragment>
          );
        })}
      &lt;/Box>
    );
  };

  const renderPlayerRotation = () => {
    if (!isTeamMode) return null;

    const playerBoxStyles = {
      pt: 3,
      pl: 0.8,
      pr: 0.8,
      width: 120,
      height: 130,
      display: 'flex',
      flexDirection: 'column',
      alignItems: 'center',
      gap: 1.5,
    };

    // Only keep floating animation keyframes
    const keyframes = {
      '@keyframes floatCenter': {
        '0%': { transform: 'scale(1.25) translateY(0px)' },
        '50%': { transform: 'scale(1.25) translateY(-10px)' },
        '100%': { transform: 'scale(1.25) translateY(0px)' }
      }
    };

    const nameStyles = {
      width: '100%',
      textAlign: 'center',
      display: '-webkit-box',
      WebkitLineClamp: 2,
      WebkitBoxOrient: 'vertical',
      overflow: 'hidden',
      lineHeight: '1.2',
      minHeight: '2.4em' // Space for two lines
    };

    // Get current player's team based on the current word chain
    const currentPlayerTeam = wordChain.length > 0 
      ? (currentPlayer === wordChain[wordChain.length - 1]?.player 
        ? wordChain[wordChain.length - 1]?.team 
        : (wordChain[wordChain.length - 1]?.team === 'blue' ? 'red' : 'blue'))
      : 'blue'; // Default to blue if no words yet

    // Function to get team color
    const getTeamColor = (isNextDirection, index) => {
      const startWithTeam = currentPlayerTeam;
      const isEvenIndex = index % 2 === 0;
      const firstTeam = isNextDirection ? (startWithTeam === 'blue' ? 'red' : 'blue') : (startWithTeam === 'blue' ? 'red' : 'blue');
      return (isEvenIndex ? firstTeam : (firstTeam === 'blue' ? 'red' : 'blue')) === 'blue' ? '#186CF6' : '#EF4444';
    };

    return (
      &lt;Box sx={{ 
        display: 'flex', 
        justifyContent: 'center',
        alignItems: 'center',
        gap: 4,
        mt: 4,
        mb: 2,
        ...keyframes
      }}>
        {/* Previous players */}
        &lt;Box sx={{ display: 'flex', gap: 2, opacity: 0.6, flexDirection: 'row-reverse' }}>
          {previousPlayers.map((player, idx) => (
            &lt;Paper
              key={`prev-${player}`}
              sx={{
                ...playerBoxStyles,
                border: `2px solid ${getTeamColor(false, idx)}`,
                opacity: 0.8 - (idx * 0.2)
              }}
            >
              &lt;Avatar sx={{ color: 'white', bgcolor: scores?.individual?.[player]?.color }}>
                {player.charAt(0).toUpperCase()}
              &lt;/Avatar>
              &lt;Typography sx={nameStyles}>
                {player}
              &lt;/Typography>
            &lt;/Paper>
          ))}
        &lt;/Box>

        {/* Current player with floating animation */}
        &lt;Paper
          elevation={6}
          sx={{
            ...playerBoxStyles,
            width: 140,
            height: 150,
            border: `3px solid ${currentPlayerTeam === 'blue' ? '#186CF6' : '#EF4444'}`,
            animation: 'floatCenter 3s ease-in-out infinite',
            zIndex: 2
          }}
        >
          &lt;Avatar 
            sx={{ 
              bgcolor: scores?.individual?.[currentPlayer]?.color,
              width: 56,
              color: 'white',
              height: 56,
              fontSize: '1.5rem'
            }}
          >
            {currentPlayer.charAt(0).toUpperCase()}
          &lt;/Avatar>
          &lt;Typography 
            variant="h6" 
            sx={{
              ...nameStyles,
              fontSize: '1.1rem', // Slightly smaller to fit better
            }}
          >
            {currentPlayer}
          &lt;/Typography>
        &lt;/Paper>

        {/* Next players */}
        &lt;Box sx={{ display: 'flex', gap: 2, opacity: 0.6 }}>
          {nextPlayers.map((player, idx) => (
            &lt;Paper
              key={`next-${player}`}
              sx={{
                ...playerBoxStyles,
                border: `2px solid ${getTeamColor(true, idx)}`,
                opacity: 0.8 - (idx * 0.2)
              }}
            >
              &lt;Avatar sx={{ color: 'white', bgcolor: scores?.individual?.[player]?.color }}>
                {player.charAt(0).toUpperCase()}
              &lt;/Avatar>
              &lt;Typography sx={nameStyles}>
                {player}
              &lt;/Typography>
            &lt;/Paper>
          ))}
        &lt;/Box>
      &lt;/Box>
    );
  };

  return (
    &lt;Box 
      sx={{ 
        display: 'flex',
        flexDirection: 'column',
        height: '100vh',
        p: 3
      }}
    >
      {/* Header with current question and letter */}
      &lt;Box sx={{ mb: 1, textAlign: 'center' }}>
        &lt;Paper
          elevation={5}
          sx={{ 
            display: 'inline-flex',
            alignItems: 'center',
            justifyContent: 'center',
            p: 3,
            borderRadius: 3,
            backgroundColor: 'primary.main',
            minWidth: 400
          }}
        >
          &lt;Typography variant="h4" sx={{ mr: 3, color: 'white' }}>
            Aktuální písmeno:
          &lt;/Typography>
          &lt;Typography 
            variant="h2" 
            component="span" 
            sx={{ 
              fontWeight: 'bold',
              color: 'white',
              display: 'inline-block',
              minWidth: 60,
            }}
          >
            {currentLetter || '?'}
          &lt;/Typography>
        &lt;/Paper>
      &lt;/Box>
      
      {/* Word chain display */}
      &lt;Box sx={{ flex: 1, overflow: 'auto' }}>
        {renderWordChain()}
      &lt;/Box>
      
      {/* Player timers and scores */}
      &lt;Box sx={{ mt: 'auto' }}>
        {renderPlayerTimers()}
        {isTeamMode &amp;&amp; renderPlayerRotation()} {/* Move player rotation here */}
      &lt;/Box>
    &lt;/Box>
  );
};

export default WordChainQuiz;
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
